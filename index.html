<!DOCTYPE html>
<html ng-app="app">

<head>
    <meta name="viewport"
        content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <link rel="stylesheet" type="text/css" href="assets/app.css">
    <title>Logic Simulator</title>
</head>

<body ng-controller="MainController">
    <div class="header">
        <h1>Logic Simulator</h1>
    </div>
    <div class="page">
        <div class="left">
            FILE
            <button ng-click="newIC()">NEW</button>
            <button ng-disabled="viewStack.length" ng-click="save()">SAVE</button>
            <hr>
            SELECTED
            <button ng-disabled="!selecteds.length" ng-click="delete()">DELETE</button>
            <button ng-disabled="selecteds.length!=1 || selecteds[0].type != 'IC'" ng-click="display()">SCOPE</button>
            <button ng-disabled="viewStack.length==0" ng-click="back()">GO BACK</button>
            <button ng-disabled="!selecteds.length" ng-click="align('top')">ALIGN TOP</button>
            <button ng-disabled="!selecteds.length" ng-click="align('right')">ALIGN RIGHT</button>
            <button ng-disabled="!selecteds.length" ng-click="align('bottom')">ALIGN BOTTOM</button>
            <button ng-disabled="!selecteds.length" ng-click="align('left')">ALIGN LEFT</button>
            <button ng-disabled="!selecteds.length" ng-click="spread()">SPREAD</button>
            <button ng-disabled="!selecteds.length" ng-click="gather()">GATHER</button>            
            <hr>
            ADD
            <button ng-click="add('INPUT')">INPUT</button>
            <button ng-click="add('OUTPUT')">OUTPUT</button>
            <button ng-click="add(gp[0])" ng-repeat="gp in gatePrototypes">{{gp[0]}}</button>
        </div>
        <div class="content">
            <svg 
                ng-attr-width="{{CW}}" ng-attr-height="{{CH}}" 
                ng-mousedown="dragStart($event)" ng-mouseup="dragEnd($event)" ng-mousemove="drag($event)">

                <!--IC INPUT PINS-->
                <g ng-repeat="p in ic.inputs">
                    <path ng-repeat="c in p.connections"
                        ng-attr-d="M{{p.pos.left*CW+PR}} {{p.pos.top*CH}} L{{c.g.pos.left*CW + c.p.pos.left*c.g.W}} {{c.g.pos.top*CH + c.p.pos.top*c.g.H}}"
                        ng-attr-stroke="{{p.value===1?'red':'gray'}}" stroke-width="4" />

                    <circle 
                        ng-attr-cx="{{p.pos.left*CW+PR}}" ng-attr-cy="{{p.pos.top*CH}}" ng-attr-r="{{PR}}"
                        ng-attr-fill="{{p.value===1?'red':'gray'}}" stroke-width="4" ng-attr-stroke="{{isSelected(p) ? 'yellow' : 'none'}}" 
                        ng-mousedown="select(p, $event)" ng-click="p.value = p.value ? 0 : 1" />

                </g>

                <!--GATE-->
                <g ng-repeat="g in ic.gates">

                    <rect ng-if="g.type!='LED'" 
                        ng-attr-x="{{g.pos.left*CW}}" ng-attr-y="{{g.pos.top*CH}}" ng-attr-width="{{g.W}}" ng-attr-height="{{g.H}}" 
                        fill="black" stroke-width="4" ng-attr-stroke="{{isSelected(g) ? 'yellow' : 'none'}}" 
                        ng-mousedown="select(g, $event)" />

                    <circle ng-if="g.type=='LED'" 
                        ng-attr-cx="{{g.pos.left*CW+g.W}}" ng-attr-cy="{{g.pos.top*CH+g.W}}" ng-attr-r="{{g.W}}" ng-attr-fill="{{g.inputs[0].value?'lime':'green'}}" 
                        stroke-width="4" ng-attr-stroke="{{isSelected(g) ? 'yellow' : 'none'}}" 
                        ng-mousedown="select(g, $event)" />

                    <text ng-if="g.type!='LED'" 
                        ng-attr-x="{{g.pos.left*CW + 20}}" ng-attr-y="{{g.pos.top*CH + 20}}"
                        ng-attr-fill="{{isSelected(g) ? 'yellow' : 'white'}}"
                        ng-mousedown="select(g, $event)">{{g.name ? g.name : g.type}}</text>

                    <!--LEDS ON COMPONENT-->
                    <circle ng-repeat="sg in g.gates" ng-if="sg.type=='LED'"
                        ng-attr-cx="{{g.pos.left*CW+sg.pos.left*g.W}}" ng-attr-cy="{{g.pos.top*CH + sg.pos.top*g.H}}" ng-attr-r="{{PR}}" 
                        ng-attr-fill="{{sg.inputs[0].value?'lime':'green'}}" stroke-width="4" stroke="none"/>

                    <!--INPUT PINS-->
                    <circle ng-repeat="p in g.inputs" title="pin"
                        ng-attr-cx="{{g.pos.left*CW + p.pos.left*g.W}}" ng-attr-cy="{{g.pos.top*CH + p.pos.top*g.H}}" ng-attr-r="{{PR}}" 
                        fill="gray" stroke-width="4" ng-attr-stroke="{{isSelected(p) ? 'yellow' : 'none'}}"
                        ng-mousedown="select(p, $event)" />

                    <!--OUTPUT PINS-->
                    <g ng-repeat="p in g.outputs">
                        <path ng-repeat="c in p.connections"
                            ng-attr-d="M{{g.pos.left*CW+p.pos.left*g.W}} {{g.pos.top*CH+p.pos.top*g.H}} L{{c.g.pos.left*CW + c.p.pos.left*c.g.W}} {{c.g.pos.top*CH + c.p.pos.top*c.g.H}}"
                            ng-attr-stroke="{{p.value===1?'red':'gray'}}" stroke-width="4" />
                        <circle 
                            ng-attr-cx="{{g.pos.left*CW + p.pos.left*g.W}}" ng-attr-cy="{{g.pos.top*CH + p.pos.top*g.H}}" ng-attr-r="{{PR}}"
                            ng-attr-fill="{{p.value===1?'red':'gray'}}" stroke-width="4" ng-attr-stroke="{{isSelected(p) ? 'yellow' : 'none'}}" 
                            ng-mousedown="select(p, $event)" />
                    </g>
                </g>

                <!--IC OUTPUT PINS-->
                <g ng-repeat="p in ic.outputs">
                    <path ng-repeat="c in p.connections"
                        ng-attr-d="M{{c.g.pos.left*CW + c.p.pos.left*c.g.W}} {{c.g.pos.top*CH + c.p.pos.top*c.g.H}} L{{p.pos.left*CW-PR}} {{p.pos.top*CH}}"
                        ng-attr-stroke="{{p.value===1?'red':'gray'}}" stroke-width="4" />

                    <circle 
                        ng-attr-cx="{{p.pos.left*CW-PR}}" ng-attr-cy="{{p.pos.top*CH}}" ng-attr-r="{{PR}}"
                        ng-attr-fill="{{p.value===1?'red':'gray'}}" stroke-width="4" ng-attr-stroke="{{isSelected(p) ? 'red' : 'none'}}" 
                        ng-mousedown="select(p, $event)" />
                </g>

                <!--SELECT TOOL-->
                <rect ng-if="selectTool" 
                    ng-attr-x="{{selectTool.start.x}}" ng-attr-y="{{selectTool.start.y}}" ng-attr-width="{{selectTool.end.x-selectTool.start.x}}" ng-attr-height="{{selectTool.end.y-selectTool.start.y}}" 
                    fill="none" stroke-width="1" stroke="gray" stroke-dasharray="5,5"/>

            </svg>
        </div>
    </div>
    <script type="text/javascript" src="assets/angular.min.js"></script>
    <script type="text/javascript" src="assets/gates.js"></script>
    <script type="text/javascript" src="assets/app.js"></script>
</body>

</html>